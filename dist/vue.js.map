{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["class Observe{\r\n  constructor(data) {\r\n    // Object.defineProperty只能劫持已经存在的属性（vue2里面会为此单独写一些api $set $delete）\r\n\r\n    if (Array.isArray(data)){\r\n      // 可以重写数组中的方法 7个变异方法 是可以修改数组本身的\r\n      // 需要保留数组原有的特性，并且可以重写部分方法\r\n      data.__proto__ =\r\n\r\n      this.observeArray(data)\r\n    }else{\r\n      this.walk(data)\r\n    }\r\n  }\r\n  walk(data){ // 循环对象 对属性依次劫持\r\n\r\n    // \"重新定义\"属性     Vue2的性能瓶颈在这也有原因\r\n    Object.keys(data).forEach(key=>defineReactive(data,key,data[key]))\r\n  }\r\n  observeArray(data){ // 观测数组\r\n    data.forEach(item=>observe(item))\r\n  }\r\n}\r\n\r\nexport function defineReactive(target,key,value){ // 闭包 属性劫持\r\n  observe(value); // 深度属性劫持——》对所有的对象都进行属性劫持    如果value仍是对象，用observe递归操作\r\n  Object.defineProperty(target,key,{\r\n    get() { // 取值的时候 会执行get\r\n      console.log('key',key)\r\n      return value\r\n    },\r\n    set(newValue) { // 修改的时候 会执行set\r\n      if (newValue === value) return\r\n      value = newValue\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(data){\r\n\r\n  // 对这个对象进行劫持\r\n\r\n  if(typeof data !== 'object' || data == null){\r\n    return; // 只对对象进行劫持\r\n  }\r\n\r\n  // 如果一个对象被劫持过了，那就不需要再被劫持了 （要判断一个对象是否被劫持过，可以增添一个实例，用实例来判断是否被劫持）\r\n\r\n  return new Observe(data);\r\n}","import {observe} from \"./observe/index\";\r\n\r\nexport function initState(vm){\r\n  const  opts = vm.$options; // 劫持所有的选项\r\n  if (opts.data){\r\n    initData(vm);\r\n  }\r\n}\r\n\r\nfunction proxy(vm,target,key){\r\n  Object.defineProperty(vm,key,{ // vm.name\r\n    get(){\r\n      console.log(\"触发get-proxy\")\r\n      return vm[target][key]; // vm._data.name\r\n    },\r\n    set(newValue){\r\n      console.log(\"触发set-proxy\")\r\n      vm[target][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\n\r\nfunction initData(vm){\r\n  let data = vm.$options.data; //data 可能是函数也可能是对象\r\n  data = typeof data === \"function\"? data.call(vm) : data; // data 是用户返回的对象\r\n\r\n  vm._data = data // 将返回的对象放到了_data\r\n  // 对数据进行劫持 vue2 里采用了一个api defineProperty\r\n  observe(data)\r\n\r\n  // 将vm._data 用vm来代理即可\r\n  for (let key in data){\r\n    proxy(vm,'_data',key);\r\n  }\r\n}","import {initState} from \"./state\";\r\n\r\nexport function initMixin(Vue){ // 就是给Vue增加init方法的\r\n  Vue.prototype._init = function (options){ //用于初始化操作\r\n    // vue vm.$options 获取用户的配置\r\n\r\n    //加 $ 表示这是Vue里的一些变量\r\n    const vm = this;\r\n    vm.$options = options; // 将用户的选项挂载到实例上\r\n\r\n    // 初始化状态\r\n    initState(vm);\r\n    // todo...编译模板 创建虚拟DOM\r\n  }\r\n\r\n}\r\n\r\n","import {initMixin} from \"./init\";\r\n\r\nfunction Vue(options){ // options 就是用户的选项\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue); // 拓展了init()\r\n\r\nexport default Vue"],"names":["Observe","constructor","data","Array","isArray","__proto__","observeArray","walk","Object","keys","forEach","key","defineReactive","item","observe","target","value","defineProperty","get","console","log","set","newValue","initState","vm","opts","$options","initData","proxy","call","_data","initMixin","Vue","prototype","_init","options"],"mappings":"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"}